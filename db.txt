ALTER TABLE paper_prices 
ADD COLUMN price_per_sheet DECIMAL(10,4) NULL;

ALTER TABLE paper_cut_prices 
ADD COLUMN price_per_sheet DECIMAL(10,4) NULL;

ALTER TABLE job_orders 
ADD COLUMN paper_pricing_method ENUM('ream', 'piece', 'custom') DEFAULT 'ream',
ADD COLUMN custom_paper_cost DECIMAL(10,2) DEFAULT 0;

-- Add total_cost column to job_orders table
ALTER TABLE job_orders 
ADD COLUMN total_cost DECIMAL(10,2) DEFAULT NULL AFTER grand_total;

CREATE VIEW job_profit_view AS
SELECT 
    id,
    client_name,
    project_name,
    grand_total,
    total_cost,
    COALESCE(total_cost, 0) - COALESCE(grand_total, 0) AS profit,
    CASE 
        WHEN COALESCE(grand_total, 0) > 0 
        THEN ROUND(((COALESCE(total_cost, 0) - COALESCE(grand_total, 0)) / grand_total) * 100, 2)
        ELSE 0 
    END AS profit_percentage
FROM job_orders;